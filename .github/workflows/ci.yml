name: CI (Pull Requests)

on:
  pull_request:

jobs:
  build:
    # 4 cpu, 16G ram
    runs-on: ubuntu-24.04
    environment: dev
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          submodules: 'recursive'

      - name: Prepare
        uses: ./.github/actions/prepare

      - name: Build and unit test
        run: ./gradlew build

      - name: Integration Tests
        run: ./gradlew integrationTest

      - name: Acceptance Tests
        run: ./gradlew acceptanceTest

      - name: Test Docker Image
        run: ./gradlew testDocker

      - name: Summarize tests results
        uses: jeantessier/test-summary-action@v1.0.7
        if: always()

      - name: Upload build reports
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: build-reports
          path: **/build/reports/